<!DOCTYPE html>
<html>
<head>
  <title>🌿 Plant Care Dashboard</title>
  <meta charset="UTF-8">
  <style>
    body { font-family: 'Segoe UI', sans-serif; margin: 1em; background: #f0f4f8; color: #333; }
    h1, h2, h3 { color: #2e7d32; }
    .top-bar { display: flex; flex-wrap: wrap; gap: 0.5em; margin-bottom: 1em; }
    .btn { padding: 0.6em 1em; background: #4caf50; color: white; border: none; border-radius: 6px; cursor: pointer; flex: 1; min-width: 120px; }
    .btn:hover { background: #388e3c; }
    .summary { font-weight: bold; margin-bottom: 1em; font-size: 1em; }
    .card { background: white; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); padding: 1em; margin-bottom: 1em; }
    .card img { width: 100%; height: auto; object-fit: cover; border-radius: 8px; border: 1px solid #ccc; margin-bottom: 0.5em; }
    .status-ok { color: #2e7d32; }
    .status-due { color: #f57c00; }
    .status-overdue { color: #c62828; }
    .log-entry { margin-bottom: 0.5em; }
    .log-entry input { margin-right: 0.5em; }
    input[type="file"] { display: none; }
    label { display: block; margin-top: 0.5em; }
    .detail { margin-top: 1em; padding-top: 1em; border-top: 1px solid #ccc; }
  </style>
</head>
<body>
  <h1>🌿 My Garden</h1>
  <div class="top-bar">
    <button class="btn" onclick="addPlant()">➕ Add Plant</button>
    <button class="btn" onclick="waterAllPlants()">💧 Water All</button>
    <button class="btn" onclick="exportGarden()">📤 Export</button>
    <button class="btn" onclick="importGarden()">📥 Import</button>
    <input type="file" id="import-file" onchange="loadGardenFile(this.files[0])">
  </div>
  <div class="summary" id="garden-summary"></div>
  <div id="dashboard"></div>

  <script>
    let plants = [];
    let selectedPlantIndex = null;

    function formatDate(ts) {
      return new Date(ts).toLocaleDateString();
    }

    function daysBetween(a, b) {
      return Math.floor((b - a) / 86400000);
    }

    function getGrowthStage(days) {
      if (days < 7) return "Seedling";
      if (days < 21) return "Vegetative";
      if (days < 40) return "Mature";
      if (days < 60) return "Flowering";
      if (days < 90) return "Harvestable";
      if (days < 120) return "Dormant";
      return "Dead";
    }

    function saveGarden() {
      localStorage.setItem("garden", JSON.stringify(plants));
    }

    function loadGarden() {
      const data = localStorage.getItem("garden");
      if (data) plants = JSON.parse(data);
    }

    function exportGarden() {
      const blob = new Blob([JSON.stringify(plants, null, 2)], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "garden.json";
      a.click();
      URL.revokeObjectURL(url);
    }

    function importGarden() {
      document.getElementById("import-file").click();
    }

    function loadGardenFile(file) {
      const reader = new FileReader();
      reader.onload = e => {
        plants = JSON.parse(e.target.result);
        saveGarden();
        renderDashboard();
      };
      reader.readAsText(file);
    }

    function addPlant() {
      const name = prompt("Plant name?");
      if (!name) return;
      const species = prompt("Species?");
      const interval = parseInt(prompt("Water every how many days?"));
      const planted = Date.now();
      plants.push({ name, species, wateringInterval: interval, planted, waterings: [planted], harvests: [], photo: "" });
      saveGarden();
      renderDashboard();
    }

    function waterAllPlants() {
      const now = Date.now();
      plants.forEach(p => p.waterings.push(now));
      saveGarden();
      renderDashboard();
    }

    function getNextWateringDate(plant) {
      const last = plant.waterings[plant.waterings.length - 1];
      return last + plant.wateringInterval * 86400000;
    }

    function renderDashboard() {
      const dash = document.getElementById("dashboard");
      dash.innerHTML = "";
      let overdue = 0, totalHarvest = 0;

      plants.forEach((p, i) => {
        const lastWatered = p.waterings[p.waterings.length - 1];
        const nextWater = getNextWateringDate(p);
        const days = daysBetween(p.planted, Date.now());
        const stage = getGrowthStage(days);
        const harvestSum = p.harvests.reduce((sum, h) => sum + h.amount, 0);
        totalHarvest += harvestSum;

        let statusClass = "status-ok";
        if (Date.now() > nextWater) { statusClass = "status-overdue"; overdue++; }
        else if (Date.now() + 2 * 86400000 > nextWater) { statusClass = "status-due"; }

        const card = document.createElement("div");
        card.className = "card";

        const img = document.createElement("img");
        img.src = p.photo || "https://via.placeholder.com/300x150?text=No+Photo";

        const content = document.createElement("div");
        content.innerHTML = `
          <strong>${p.name}</strong><br>
          ${p.species}<br>
          Stage: ${stage}<br>
          <span class="${statusClass}">Next: ${formatDate(nextWater)}</span><br>
          🧺 ${harvestSum} ${p.harvests[0]?.unit || ""}
        `;

        card.appendChild(img);
        card.appendChild(content);

        const toggleBtn = document.createElement("button");
        toggleBtn.className = "btn";
        toggleBtn.textContent = selectedPlantIndex === i ? "⬆ Hide Details" : "⬇ Show Details";
        toggleBtn.onclick = () => {
          selectedPlantIndex = selectedPlantIndex === i ? null : i;
          renderDashboard();
        };
        card.appendChild(toggleBtn);

        if (selectedPlantIndex === i) {
          const detail = document.createElement("div");
          detail.className = "detail";

          detail.innerHTML = `
            <label>Change Photo: <input type="file" accept="image/*" onchange="uploadPhoto(event, ${i})"></label>
            <label>Name: <input value="${p.name}" onchange="plants[${i}].name=this.value; saveGarden(); renderDashboard()"></label>
            <label>Species: <input value="${p.species}" onchange="plants[${i}].species=this.value; saveGarden(); renderDashboard()"></label>
            <label>Watering Interval (days): <input type="number" value="${p.wateringInterval}" onchange="plants[${i}].wateringInterval=parseInt(this.value); saveGarden(); renderDashboard()"></label>
            <label>Planted Date: <input type="date" value="${new Date(p.planted).toISOString().split('T')[0]}" onchange="plants[${i}].planted=new Date(this.value).getTime(); saveGarden(); renderDashboard()"></label>
            <h3>💧 Watering History</h3>
          `;

          p.waterings.forEach((w, wi) => {
            const entry = document.createElement("div");
            entry.className = "log-entry";
            entry.innerHTML = `
              <input type="date" value="${new Date(w).toISOString().split('T')[0]}"
                onchange="plants[${i}].waterings[${wi}]=new Date(this.value).getTime(); saveGarden(); renderDashboard()">
              <button onclick="plants[${i}].waterings.splice(${wi},1); saveGarden(); renderDashboard()">🗑️</button>
            `;
            detail.appendChild(entry);
          });

          const addWaterBtn = document.createElement("button");
          addWaterBtn.className = "btn";
          addWaterBtn.textContent = "💧 Add Watering";
          addWaterBtn.onclick = () => {
            plants[i].waterings.push(Date.now());
            saveGarden();
            renderDashboard();
          };
          detail.appendChild(addWaterBtn);

          detail.innerHTML += `<h3>🧺 Harvest History</h3>`;
          plants[i].harvests.forEach((h, hi) => {
            const entry = document.createElement("div");
            entry.className = "log-entry";
            entry.innerHTML = `
              <input type="date" value="${new Date(h.date).toISOString().split('T')[0]}"
                onchange="plants[${i}].harvests[${hi}].date=new Date(this.value).getTime(); saveGarden(); renderDashboard()">
              <input type="number" value="${h.amount}" onchange="plants[${i}].harvests[${hi}].amount=parseInt(this.value); saveGarden(); renderDashboard()">
              <input type="text" value="${h.unit}" onchange="plants[${i}].harvests[${hi}].unit=this.value; saveGarden(); renderDashboard()">
              <button onclick="plants[${i}].harvests.splice(${hi},1); saveGarden(); renderDashboard()">🗑️</button>
            `;
            detail.appendChild(entry);
          });

          const amtInput = document.createElement("input");
          amtInput.id = "harvest-amount";
          amtInput.type = "number";
          amtInput.placeholder = "Amount";
          const unitInput = document.createElement("input");
          unitInput.id = "harvest-unit";
          unitInput.type = "text";
          unitInput.placeholder = "Unit (e.g. grams)";
          const recordBtn = document.createElement("button");
          recordBtn.className = "btn";
          recordBtn.textContent = "🧺 Record Harvest";
          recordBtn.onclick = () => recordHarvest(i);

          detail.appendChild(amtInput);
          detail.appendChild(unitInput);
          detail.appendChild(recordBtn);

          card.appendChild(detail);
        }

        dash.appendChild(card);
      });

      document.getElementById("garden-summary").textContent =
        `🌱 ${plants.length} plant(s) | 🔔 ${overdue} overdue | 🧺 ${totalHarvest} total harvest units`;
    }

    function uploadPhoto(event, index) {
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = e => {
        plants[index].photo = e.target.result;
        saveGarden();
        renderDashboard();
      };
      reader.readAsDataURL(file);
    }

    function recordHarvest(index) {
      const amt = parseInt(document.getElementById("harvest-amount").value);
      const unit = document.getElementById("harvest-unit").value || "units";
      if (!amt) return;
      plants[index].harvests.push({ date: Date.now(), amount: amt, unit });
      saveGarden();
      renderDashboard();
    }

    loadGarden();
    renderDashboard();
  </script>
</body>
</html>
