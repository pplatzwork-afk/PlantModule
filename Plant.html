<!DOCTYPE html>
<html>
<head>
  <title>🌿 Plant Care Dashboard</title>
  <meta charset="UTF-8">
  <style>
    body { font-family: sans-serif; margin: 2em; background: #f9f9f9; }
    h1, h2, h3 { color: #2e7d32; }
    .card, .detail { border: 1px solid #ccc; background: #fff; padding: 1em; margin-bottom: 1em; border-radius: 8px; }
    .card:hover { background: #e8f5e9; cursor: pointer; }
    .btn { padding: 0.5em 1em; margin: 0.5em 0; background: #4caf50; color: white; border: none; border-radius: 4px; cursor: pointer; }
    .btn:hover { background: #388e3c; }
    input, select { margin: 0.3em 0; padding: 0.3em; width: 100%; }
    .hidden { display: none; }
    .summary { font-weight: bold; margin-bottom: 1em; }
    .log-entry { margin-bottom: 0.5em; }
    .log-entry input { width: auto; margin-right: 0.5em; }
    .top-bar { display: flex; gap: 1em; margin-bottom: 1em; flex-wrap: wrap; }
  </style>
</head>
<body>
  <h1>🌿 My Garden</h1>
  <div class="top-bar">
    <button class="btn" onclick="addPlant()">➕ Add Plant</button>
    <button class="btn" onclick="exportGarden()">📤 Export</button>
    <button class="btn" onclick="importGarden()">📥 Import</button>
  </div>
  <div class="summary" id="garden-summary"></div>
  <div id="dashboard"></div>
  <div id="plant-detail" class="hidden"></div>
  <input type="file" id="import-file" class="hidden" onchange="loadGardenFile(this.files[0])">

  <script>
    let plants = [];

    function formatDate(ts) {
      return new Date(ts).toLocaleDateString();
    }

    function daysBetween(a, b) {
      return Math.floor((b - a) / 86400000);
    }

    function saveGarden() {
      localStorage.setItem("garden", JSON.stringify(plants));
    }

    function loadGarden() {
      const data = localStorage.getItem("garden");
      if (data) plants = JSON.parse(data);
    }

    function exportGarden() {
      const blob = new Blob([JSON.stringify(plants, null, 2)], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "garden.json";
      a.click();
      URL.revokeObjectURL(url);
    }

    function importGarden() {
      document.getElementById("import-file").click();
    }

    function loadGardenFile(file) {
      const reader = new FileReader();
      reader.onload = e => {
        plants = JSON.parse(e.target.result);
        saveGarden();
        renderDashboard();
      };
      reader.readAsText(file);
    }

    function addPlant() {
      const name = prompt("Plant name?");
      if (!name) return;
      const species = prompt("Species?");
      const interval = parseInt(prompt("Water every how many days?"));
      const planted = Date.now();
      plants.push({
        name, species, wateringInterval: interval,
        planted, waterings: [planted],
        harvests: []
      });
      saveGarden();
      renderDashboard();
    }

    function renderDashboard() {
      document.getElementById("plant-detail").classList.add("hidden");
      const dash = document.getElementById("dashboard");
      dash.innerHTML = "";
      plants.forEach((p, i) => {
        const lastWatered = p.waterings[p.waterings.length - 1];
        const nextWater = lastWatered + p.wateringInterval * 86400000;
        const growthDays = daysBetween(p.planted, Date.now());
        const totalHarvest = p.harvests.reduce((sum, h) => sum + h.amount, 0);
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <strong>${p.name}</strong> (${p.species})<br>
          Planted: ${formatDate(p.planted)} (${growthDays} days)<br>
          Last watered: ${formatDate(lastWatered)}<br>
          Next watering in ${daysBetween(Date.now(), nextWater)} day(s)<br>
          Total harvest: ${totalHarvest} ${p.harvests[0]?.unit || ""}
        `;
        card.onclick = () => showPlantDetail(i);
        dash.appendChild(card);
      });
      renderSummary();
    }

    function renderSummary() {
      const total = plants.length;
      const upcoming = plants.filter(p => {
        const last = p.waterings[p.waterings.length - 1];
        const next = last + p.wateringInterval * 86400000;
        return next < Date.now() + 2 * 86400000;
      }).length;
      const harvests = plants.reduce((sum, p) => sum + p.harvests.reduce((s, h) => s + h.amount, 0), 0);
      document.getElementById("garden-summary").textContent =
        `🌱 ${total} plant(s) | 💧 ${upcoming} need watering soon | 🧺 ${harvests} total harvest units`;
    }

    function showPlantDetail(index) {
      const p = plants[index];
      const detail = document.getElementById("plant-detail");
      detail.className = "detail";
      const growthDays = daysBetween(p.planted, Date.now());
      const totalHarvest = p.harvests.reduce((sum, h) => sum + h.amount, 0);
      detail.innerHTML = `
        <h2>${p.name} Details</h2>
        <label>Name: <input value="${p.name}" onchange="plants[${index}].name=this.value; saveGarden(); renderDashboard(); showPlantDetail(${index})"></label>
        <label>Species: <input value="${p.species}" onchange="plants[${index}].species=this.value; saveGarden(); renderDashboard(); showPlantDetail(${index})"></label>
        <label>Watering Interval (days): <input type="number" value="${p.wateringInterval}" onchange="plants[${index}].wateringInterval=parseInt(this.value); saveGarden(); renderDashboard(); showPlantDetail(${index})"></label>
        <label>Planted Date: <input type="date" value="${new Date(p.planted).toISOString().split('T')[0]}" onchange="plants[${index}].planted=new Date(this.value).getTime(); saveGarden(); renderDashboard(); showPlantDetail(${index})"></label>
        <p>🌱 Growth Stage: ${growthDays} day(s)</p>
        <p>🧺 Total Harvest: ${totalHarvest} ${p.harvests[0]?.unit || ""}</p>

        <h3>💧 Watering History</h3>
        ${p.waterings.map((w, wi) => `
          <div class="log-entry">
            <input type="date" value="${new Date(w).toISOString().split('T')[0]}"
              onchange="plants[${index}].waterings[${wi}]=new Date(this.value).getTime(); saveGarden(); renderDashboard(); showPlantDetail(${index})">
            <button onclick="plants[${index}].waterings.splice(${wi},1); saveGarden(); renderDashboard(); showPlantDetail(${index})">🗑️</button>
          </div>
        `).join("")}
        <button class="btn" onclick="plants[${index}].waterings.push(Date.now()); saveGarden(); renderDashboard(); showPlantDetail(${index})">💧 Add Watering</button>

        <h3>🧺 Harvest History</h3>
        ${p.harvests.map((h, hi) => `
          <div class="log-entry">
            <input type="date" value="${new Date(h.date).toISOString().split('T')[0]}"
              onchange="plants[${index}].harvests[${hi}].date=new Date(this.value).getTime(); saveGarden(); renderDashboard(); showPlantDetail(${index})">
            <input type="number" value="${h.amount}" onchange="plants[${index}].harvests[${hi}].amount=parseInt(this.value); saveGarden(); renderDashboard(); showPlantDetail(${index})
            <input type="text" value="${h.unit}" onchange="plants[${index}].harvests[${hi}].unit=this.value; saveGarden(); renderDashboard(); showPlantDetail(${index})">
            <button onclick="plants[${index}].harvests.splice(${hi},1); saveGarden(); renderDashboard(); showPlantDetail(${index})">🗑️</button>
          </div>
        `).join("")}
        <label>Amount: <input id="harvest-amount" type="number" min="1"></label>
        <label>Unit: <input id="harvest-unit" type="text" placeholder="e.g. grams"></label>
        <button class="btn" onclick="recordHarvest(${index})">🧺 Record Harvest</button><br><br>
        <button class="btn" onclick="document.getElementById('plant-detail').className='hidden'">⬅ Back to Dashboard</button>
      `;
    }

    function recordHarvest(index) {
      const amt = parseInt(document.getElementById("harvest-amount").value);
      const unit = document.getElementById("harvest-unit").value || "units";
      if (!amt) return;
      plants[index].harvests.push({ date: Date.now(), amount: amt, unit });
      saveGarden();
      renderDashboard();
      showPlantDetail(index);
    }
  </script>
</body>
</html>
